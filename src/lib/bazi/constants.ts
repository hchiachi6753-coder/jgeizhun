/**
 * 八字排盤常量定義
 * 包含天干、地支、五行、十神等基礎資料
 */

// ============ 天干 ============
export const TIAN_GAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'] as const;
export type TianGan = typeof TIAN_GAN[number];

// ============ 地支 ============
export const DI_ZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'] as const;
export type DiZhi = typeof DI_ZHI[number];

// ============ 五行 ============
export const WU_XING = ['木', '火', '土', '金', '水'] as const;
export type WuXing = typeof WU_XING[number];

// ============ 十神 ============
export const SHI_SHEN = ['比肩', '劫財', '食神', '傷官', '偏財', '正財', '七殺', '正官', '偏印', '正印'] as const;
export type ShiShen = typeof SHI_SHEN[number];

// ============ 天干五行對照 ============
export const GAN_WU_XING: Record<TianGan, WuXing> = {
  '甲': '木', '乙': '木',
  '丙': '火', '丁': '火',
  '戊': '土', '己': '土',
  '庚': '金', '辛': '金',
  '壬': '水', '癸': '水'
};

// ============ 地支五行對照（以本氣為主）============
export const ZHI_WU_XING: Record<DiZhi, WuXing> = {
  '子': '水', '丑': '土',
  '寅': '木', '卯': '木',
  '辰': '土', '巳': '火',
  '午': '火', '未': '土',
  '申': '金', '酉': '金',
  '戌': '土', '亥': '水'
};

// ============ 天干陰陽 ============
// 1 = 陽，0 = 陰
export const GAN_YIN_YANG: Record<TianGan, 0 | 1> = {
  '甲': 1, '乙': 0,
  '丙': 1, '丁': 0,
  '戊': 1, '己': 0,
  '庚': 1, '辛': 0,
  '壬': 1, '癸': 0
};

// ============ 地支陰陽 ============
export const ZHI_YIN_YANG: Record<DiZhi, 0 | 1> = {
  '子': 1, '丑': 0,
  '寅': 1, '卯': 0,
  '辰': 1, '巳': 0,
  '午': 1, '未': 0,
  '申': 1, '酉': 0,
  '戌': 1, '亥': 0
};

// ============ 地支藏干 ============
// 順序：本氣、中氣、餘氣
export const ZHI_CANG_GAN: Record<DiZhi, TianGan[]> = {
  '子': ['癸'],
  '丑': ['己', '癸', '辛'],
  '寅': ['甲', '丙', '戊'],
  '卯': ['乙'],
  '辰': ['戊', '乙', '癸'],
  '巳': ['丙', '庚', '戊'],
  '午': ['丁', '己'],
  '未': ['己', '丁', '乙'],
  '申': ['庚', '壬', '戊'],
  '酉': ['辛'],
  '戌': ['戊', '辛', '丁'],
  '亥': ['壬', '甲']
};

// ============ 十二時辰 ============
export const SHI_CHEN = [
  { name: '子時', zhi: '子' as DiZhi, range: '23:00-01:00', hours: [23, 0] },
  { name: '丑時', zhi: '丑' as DiZhi, range: '01:00-03:00', hours: [1, 2] },
  { name: '寅時', zhi: '寅' as DiZhi, range: '03:00-05:00', hours: [3, 4] },
  { name: '卯時', zhi: '卯' as DiZhi, range: '05:00-07:00', hours: [5, 6] },
  { name: '辰時', zhi: '辰' as DiZhi, range: '07:00-09:00', hours: [7, 8] },
  { name: '巳時', zhi: '巳' as DiZhi, range: '09:00-11:00', hours: [9, 10] },
  { name: '午時', zhi: '午' as DiZhi, range: '11:00-13:00', hours: [11, 12] },
  { name: '未時', zhi: '未' as DiZhi, range: '13:00-15:00', hours: [13, 14] },
  { name: '申時', zhi: '申' as DiZhi, range: '15:00-17:00', hours: [15, 16] },
  { name: '酉時', zhi: '酉' as DiZhi, range: '17:00-19:00', hours: [17, 18] },
  { name: '戌時', zhi: '戌' as DiZhi, range: '19:00-21:00', hours: [19, 20] },
  { name: '亥時', zhi: '亥' as DiZhi, range: '21:00-23:00', hours: [21, 22] },
] as const;

// ============ 二十四節氣 ============
export const JIE_QI = [
  '立春', '雨水', '驚蟄', '春分', '清明', '穀雨',
  '立夏', '小滿', '芒種', '夏至', '小暑', '大暑',
  '立秋', '處暑', '白露', '秋分', '寒露', '霜降',
  '立冬', '小雪', '大雪', '冬至', '小寒', '大寒'
] as const;

// 節氣對應的月支（只取「節」，不取「氣」）
// 立春→寅月，驚蟄→卯月...
export const JIE_TO_MONTH_ZHI: Record<string, DiZhi> = {
  '立春': '寅', '驚蟄': '卯', '清明': '辰', '立夏': '巳',
  '芒種': '午', '小暑': '未', '立秋': '申', '白露': '酉',
  '寒露': '戌', '立冬': '亥', '大雪': '子', '小寒': '丑'
};

// ============ 六十甲子納音 ============
export const SIXTY_JIAZI_NAYIN: Record<string, string> = {
  '甲子': '海中金', '乙丑': '海中金',
  '丙寅': '爐中火', '丁卯': '爐中火',
  '戊辰': '大林木', '己巳': '大林木',
  '庚午': '路旁土', '辛未': '路旁土',
  '壬申': '劍鋒金', '癸酉': '劍鋒金',
  '甲戌': '山頭火', '乙亥': '山頭火',
  '丙子': '澗下水', '丁丑': '澗下水',
  '戊寅': '城頭土', '己卯': '城頭土',
  '庚辰': '白蠟金', '辛巳': '白蠟金',
  '壬午': '楊柳木', '癸未': '楊柳木',
  '甲申': '泉中水', '乙酉': '泉中水',
  '丙戌': '屋上土', '丁亥': '屋上土',
  '戊子': '霹靂火', '己丑': '霹靂火',
  '庚寅': '松柏木', '辛卯': '松柏木',
  '壬辰': '長流水', '癸巳': '長流水',
  '甲午': '沙中金', '乙未': '沙中金',
  '丙申': '山下火', '丁酉': '山下火',
  '戊戌': '平地木', '己亥': '平地木',
  '庚子': '壁上土', '辛丑': '壁上土',
  '壬寅': '金箔金', '癸卯': '金箔金',
  '甲辰': '覆燈火', '乙巳': '覆燈火',
  '丙午': '天河水', '丁未': '天河水',
  '戊申': '大驛土', '己酉': '大驛土',
  '庚戌': '釵釧金', '辛亥': '釵釧金',
  '壬子': '桑柘木', '癸丑': '桑柘木',
  '甲寅': '大溪水', '乙卯': '大溪水',
  '丙辰': '沙中土', '丁巳': '沙中土',
  '戊午': '天上火', '己未': '天上火',
  '庚申': '石榴木', '辛酉': '石榴木',
  '壬戌': '大海水', '癸亥': '大海水'
};

// ============ 五行生剋關係 ============
// 五行相生：木生火、火生土、土生金、金生水、水生木
export const WU_XING_SHENG: Record<WuXing, WuXing> = {
  '木': '火', '火': '土', '土': '金', '金': '水', '水': '木'
};

// 五行相剋：木剋土、土剋水、水剋火、火剋金、金剋木
export const WU_XING_KE: Record<WuXing, WuXing> = {
  '木': '土', '土': '水', '水': '火', '火': '金', '金': '木'
};

// ============ 地支六合 ============
export const DI_ZHI_LIU_HE: Record<DiZhi, DiZhi> = {
  '子': '丑', '丑': '子',
  '寅': '亥', '亥': '寅',
  '卯': '戌', '戌': '卯',
  '辰': '酉', '酉': '辰',
  '巳': '申', '申': '巳',
  '午': '未', '未': '午'
};

// 六合後化的五行
export const LIU_HE_HUA: Record<string, WuXing> = {
  '子丑': '土', '丑子': '土',
  '寅亥': '木', '亥寅': '木',
  '卯戌': '火', '戌卯': '火',
  '辰酉': '金', '酉辰': '金',
  '巳申': '水', '申巳': '水',
  '午未': '火', '未午': '火'  // 午未合化有爭議，一說為火，一說為土
};

// ============ 地支三合局 ============
export const DI_ZHI_SAN_HE: { [key: string]: { members: DiZhi[], element: WuXing } } = {
  '水局': { members: ['申', '子', '辰'], element: '水' },
  '木局': { members: ['亥', '卯', '未'], element: '木' },
  '火局': { members: ['寅', '午', '戌'], element: '火' },
  '金局': { members: ['巳', '酉', '丑'], element: '金' }
};

// ============ 地支三會方 ============
export const DI_ZHI_SAN_HUI: { [key: string]: { members: DiZhi[], element: WuXing } } = {
  '東方木': { members: ['寅', '卯', '辰'], element: '木' },
  '南方火': { members: ['巳', '午', '未'], element: '火' },
  '西方金': { members: ['申', '酉', '戌'], element: '金' },
  '北方水': { members: ['亥', '子', '丑'], element: '水' }
};

// ============ 地支六沖 ============
export const DI_ZHI_LIU_CHONG: Record<DiZhi, DiZhi> = {
  '子': '午', '午': '子',
  '丑': '未', '未': '丑',
  '寅': '申', '申': '寅',
  '卯': '酉', '酉': '卯',
  '辰': '戌', '戌': '辰',
  '巳': '亥', '亥': '巳'
};

// ============ 地支相刑 ============
export const DI_ZHI_XING = {
  // 寅巳申三刑（無恩之刑）
  '無恩之刑': ['寅', '巳', '申'] as DiZhi[],
  // 丑戌未三刑（恃勢之刑）
  '恃勢之刑': ['丑', '戌', '未'] as DiZhi[],
  // 子卯相刑（無禮之刑）
  '無禮之刑': ['子', '卯'] as DiZhi[],
  // 辰午酉亥自刑
  '自刑': ['辰', '午', '酉', '亥'] as DiZhi[]
};

// ============ 地支相害（六害）============
export const DI_ZHI_HAI: Record<DiZhi, DiZhi> = {
  '子': '未', '未': '子',
  '丑': '午', '午': '丑',
  '寅': '巳', '巳': '寅',
  '卯': '辰', '辰': '卯',
  '申': '亥', '亥': '申',
  '酉': '戌', '戌': '酉'
};

// ============ 天干五合 ============
export const TIAN_GAN_HE: Record<TianGan, TianGan> = {
  '甲': '己', '己': '甲',
  '乙': '庚', '庚': '乙',
  '丙': '辛', '辛': '丙',
  '丁': '壬', '壬': '丁',
  '戊': '癸', '癸': '戊'
};

// 天干合化後的五行
export const TIAN_GAN_HE_HUA: Record<string, WuXing> = {
  '甲己': '土', '己甲': '土',
  '乙庚': '金', '庚乙': '金',
  '丙辛': '水', '辛丙': '水',
  '丁壬': '木', '壬丁': '木',
  '戊癸': '火', '癸戊': '火'
};

// ============ 天干相沖 ============
// 注意：天干相沖主要是相剋的概念
// 甲庚沖（金剋木）、乙辛沖（金剋木）、丙壬沖（水剋火）、丁癸沖（水剋火）
// 戊己為土，通常不論沖，這裡保留傳統說法
export const TIAN_GAN_CHONG: Record<TianGan, TianGan> = {
  '甲': '庚',
  '乙': '辛',
  '丙': '壬',
  '丁': '癸',
  '戊': '壬',  // 戊土見壬水（土剋水或水潤土，視情況而定）
  '己': '癸',  // 己土見癸水
  '庚': '甲',
  '辛': '乙',
  '壬': '丙',
  '癸': '丁'
};

// ============ 十二長生 ============
export const TWELVE_STAGES = ['長生', '沐浴', '冠帶', '臨官', '帝旺', '衰', '病', '死', '墓', '絕', '胎', '養'] as const;
export type TwelveStage = typeof TWELVE_STAGES[number];

// 各天干的十二長生起點（陽干順行，陰干逆行）
// 格式：天干 -> 長生所在地支
export const GAN_CHANGSHENG: Record<TianGan, DiZhi> = {
  '甲': '亥', '乙': '午',
  '丙': '寅', '丁': '酉',
  '戊': '寅', '己': '酉',
  '庚': '巳', '辛': '子',
  '壬': '申', '癸': '卯'
};

// ============ 調候用神表（節選）============
// 根據《窮通寶鑑》整理
export const TIAO_HOU_YONG_SHEN: Record<string, { main: TianGan[], auxiliary: TianGan[] }> = {
  // 甲木
  '甲寅': { main: ['丙'], auxiliary: ['癸'] },
  '甲卯': { main: ['庚'], auxiliary: ['丁'] },
  '甲辰': { main: ['庚'], auxiliary: ['壬'] },
  '甲巳': { main: ['癸'], auxiliary: ['丁', '庚'] },
  '甲午': { main: ['癸'], auxiliary: ['丁', '庚'] },
  '甲未': { main: ['癸'], auxiliary: ['丁', '庚'] },
  '甲申': { main: ['丁'], auxiliary: ['庚'] },
  '甲酉': { main: ['丁'], auxiliary: ['丙', '庚'] },
  '甲戌': { main: ['庚'], auxiliary: ['丁', '壬'] },
  '甲亥': { main: ['庚'], auxiliary: ['丁', '丙'] },
  '甲子': { main: ['丁'], auxiliary: ['庚', '丙'] },
  '甲丑': { main: ['丁'], auxiliary: ['庚', '丙'] },
  // 乙木
  '乙寅': { main: ['丙'], auxiliary: ['癸'] },
  '乙卯': { main: ['丙'], auxiliary: ['癸'] },
  '乙辰': { main: ['癸'], auxiliary: ['丙'] },
  '乙巳': { main: ['癸'], auxiliary: ['丙'] },
  '乙午': { main: ['癸'], auxiliary: ['丙'] },
  '乙未': { main: ['癸'], auxiliary: ['丙'] },
  '乙申': { main: ['丙'], auxiliary: ['癸', '己'] },
  '乙酉': { main: ['丙'], auxiliary: ['癸', '己'] },
  '乙戌': { main: ['癸'], auxiliary: ['丙'] },
  '乙亥': { main: ['丙'], auxiliary: ['戊'] },
  '乙子': { main: ['丙'], auxiliary: ['戊'] },
  '乙丑': { main: ['丙'], auxiliary: ['戊'] },
  // 丙火
  '丙寅': { main: ['壬'], auxiliary: ['庚'] },
  '丙卯': { main: ['壬'], auxiliary: ['己'] },
  '丙辰': { main: ['壬'], auxiliary: ['甲'] },
  '丙巳': { main: ['壬'], auxiliary: ['庚'] },
  '丙午': { main: ['壬'], auxiliary: ['庚'] },
  '丙未': { main: ['壬'], auxiliary: ['庚'] },
  '丙申': { main: ['壬'], auxiliary: ['戊'] },
  '丙酉': { main: ['壬'], auxiliary: ['甲'] },
  '丙戌': { main: ['甲'], auxiliary: ['壬'] },
  '丙亥': { main: ['甲'], auxiliary: ['戊', '庚', '壬'] },
  '丙子': { main: ['壬'], auxiliary: ['甲'] },
  '丙丑': { main: ['壬'], auxiliary: ['甲'] },
  // ... 其他天干可依此類推
};

// ============ 寒暖燥濕分數（用於調候計算）============
// 正值表示暖燥，負值表示寒濕
export const GAN_HANRE_SCORE: Record<TianGan, number> = {
  '甲': 0, '乙': 0,
  '丙': 3, '丁': 2,
  '戊': 1, '己': 0,
  '庚': -1, '辛': -1,
  '壬': -2, '癸': -3
};

export const ZHI_HANRE_SCORE: Record<DiZhi, number> = {
  '子': -3, '丑': -2,
  '寅': 1, '卯': 0,
  '辰': -1, '巳': 2,
  '午': 3, '未': 2,
  '申': 0, '酉': -1,
  '戌': 1, '亥': -2
};

// 月令加權（月令對寒暖燥濕影響最大）
export const MONTH_HANRE_WEIGHT = 2;
